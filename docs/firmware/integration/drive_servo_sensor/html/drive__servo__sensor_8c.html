<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Integration driving and servo-sensor: drive_servo_sensor.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Integration driving and servo-sensor
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">drive_servo_sensor.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>File with second stop of project integration.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Macros used in program</div></td></tr>
<tr class="memitem:aac3553b3932cbfeeac4526ce7ca0336b" id="r_aac3553b3932cbfeeac4526ce7ca0336b"><td class="memItemLeft" align="right" valign="top"><a id="aac3553b3932cbfeeac4526ce7ca0336b" name="aac3553b3932cbfeeac4526ce7ca0336b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SPEED</b>&#160;&#160;&#160;125</td></tr>
<tr class="memdesc:aac3553b3932cbfeeac4526ce7ca0336b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro that defines speed of the vehicle (0-255) <br /></td></tr>
<tr class="separator:aac3553b3932cbfeeac4526ce7ca0336b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff0f2d52596a7a0b104ef88aa1eccd2b" id="r_aff0f2d52596a7a0b104ef88aa1eccd2b"><td class="memItemLeft" align="right" valign="top"><a id="aff0f2d52596a7a0b104ef88aa1eccd2b" name="aff0f2d52596a7a0b104ef88aa1eccd2b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DEVICE_ADDR</b>&#160;&#160;&#160;0xE0</td></tr>
<tr class="memdesc:aff0f2d52596a7a0b104ef88aa1eccd2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">I2C address of the device. <br /></td></tr>
<tr class="separator:aff0f2d52596a7a0b104ef88aa1eccd2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa44e519f68ab22d530cd062dd7049fee" id="r_aa44e519f68ab22d530cd062dd7049fee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa44e519f68ab22d530cd062dd7049fee">initialize_servo_for_sensor</a> ()</td></tr>
<tr class="separator:aa44e519f68ab22d530cd062dd7049fee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7799a5f0d85ef019453dfe5e24bb7d1" id="r_aa7799a5f0d85ef019453dfe5e24bb7d1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa7799a5f0d85ef019453dfe5e24bb7d1">set_servo_sensor_to_starting_pos</a> ()</td></tr>
<tr class="separator:aa7799a5f0d85ef019453dfe5e24bb7d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e59225bfc4259591f302dc1b70f53a1" id="r_a5e59225bfc4259591f302dc1b70f53a1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5e59225bfc4259591f302dc1b70f53a1">initialize_ADC</a> ()</td></tr>
<tr class="separator:a5e59225bfc4259591f302dc1b70f53a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75f5d9cca5076d0db292bfc3ca3d7170" id="r_a75f5d9cca5076d0db292bfc3ca3d7170"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a75f5d9cca5076d0db292bfc3ca3d7170">I2C_Send_Message</a> (unsigned short dev_addr, unsigned short reg_addr, unsigned short data_value)</td></tr>
<tr class="separator:a75f5d9cca5076d0db292bfc3ca3d7170"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4a39a9450cbc2f03a62869640d443b6" id="r_ab4a39a9450cbc2f03a62869640d443b6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab4a39a9450cbc2f03a62869640d443b6">initialize_I2C</a> ()</td></tr>
<tr class="separator:ab4a39a9450cbc2f03a62869640d443b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb6983eff31c6153e994997ac3381358" id="r_acb6983eff31c6153e994997ac3381358"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acb6983eff31c6153e994997ac3381358">drive_forward</a> ()</td></tr>
<tr class="separator:acb6983eff31c6153e994997ac3381358"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff9b2f2caddd39a66f030c08ef987cd1" id="r_aff9b2f2caddd39a66f030c08ef987cd1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aff9b2f2caddd39a66f030c08ef987cd1">brake</a> ()</td></tr>
<tr class="separator:aff9b2f2caddd39a66f030c08ef987cd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f0ff40e5886cd651113e8706b5ee772" id="r_a4f0ff40e5886cd651113e8706b5ee772"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4f0ff40e5886cd651113e8706b5ee772">scan_space_with_sensor</a> ()</td></tr>
<tr class="separator:a4f0ff40e5886cd651113e8706b5ee772"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdef7a1fd863a6d3770c1268cb06add3" id="r_acdef7a1fd863a6d3770c1268cb06add3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acdef7a1fd863a6d3770c1268cb06add3">main</a> ()</td></tr>
<tr class="separator:acdef7a1fd863a6d3770c1268cb06add3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Declaring duty cycles which will be used for servo_sensor scanning</div></td></tr>
<tr class="memitem:a5202db193dfb4090fcbdbd1b1e8bfa0d" id="r_a5202db193dfb4090fcbdbd1b1e8bfa0d"><td class="memItemLeft" align="right" valign="top"><a id="a5202db193dfb4090fcbdbd1b1e8bfa0d" name="a5202db193dfb4090fcbdbd1b1e8bfa0d"></a>
unsigned&#160;</td><td class="memItemRight" valign="bottom"><b>pwm_period</b> = 0</td></tr>
<tr class="separator:a5202db193dfb4090fcbdbd1b1e8bfa0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab752277653bf4ca366fd22ad687edb9a" id="r_ab752277653bf4ca366fd22ad687edb9a"><td class="memItemLeft" align="right" valign="top"><a id="ab752277653bf4ca366fd22ad687edb9a" name="ab752277653bf4ca366fd22ad687edb9a"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>duty_cycle</b> = 0</td></tr>
<tr class="separator:ab752277653bf4ca366fd22ad687edb9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a5fdc2661bb72a7173e58f2c9dca677" id="r_a1a5fdc2661bb72a7173e58f2c9dca677"><td class="memItemLeft" align="right" valign="top"><a id="a1a5fdc2661bb72a7173e58f2c9dca677" name="a1a5fdc2661bb72a7173e58f2c9dca677"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>duty_cycles</b> [] = {2.0, 4.7, 7.5, 10.2, 13.0}</td></tr>
<tr class="separator:a1a5fdc2661bb72a7173e58f2c9dca677"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">Sensor reading values</div></td></tr>
<tr class="memitem:a2c2701f20ed02c869667a8b8a89fb856" id="r_a2c2701f20ed02c869667a8b8a89fb856"><td class="memItemLeft" align="right" valign="top"><a id="a2c2701f20ed02c869667a8b8a89fb856" name="a2c2701f20ed02c869667a8b8a89fb856"></a>
unsigned&#160;</td><td class="memItemRight" valign="bottom"><b>sensor_reading</b> = 0</td></tr>
<tr class="separator:a2c2701f20ed02c869667a8b8a89fb856"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0893e1885aa6a5b25b5c6b078c73edc8" id="r_a0893e1885aa6a5b25b5c6b078c73edc8"><td class="memItemLeft" align="right" valign="top"><a id="a0893e1885aa6a5b25b5c6b078c73edc8" name="a0893e1885aa6a5b25b5c6b078c73edc8"></a>
unsigned&#160;</td><td class="memItemRight" valign="bottom"><b>sensor_values</b> [5] = {0}</td></tr>
<tr class="separator:a0893e1885aa6a5b25b5c6b078c73edc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">Enable Software I2C communication, through the desired pins</div></td></tr>
<tr class="memitem:afdd8a6c15182ccc2264d3c18bdf19876" id="r_afdd8a6c15182ccc2264d3c18bdf19876"><td class="memItemLeft" align="right" valign="top"><a id="afdd8a6c15182ccc2264d3c18bdf19876" name="afdd8a6c15182ccc2264d3c18bdf19876"></a>
sbit Soft_I2C_Sda at&#160;</td><td class="memItemRight" valign="bottom"><b>RB2_bit</b></td></tr>
<tr class="separator:afdd8a6c15182ccc2264d3c18bdf19876"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86234ed0e92aa7d3059137cb0206c855" id="r_a86234ed0e92aa7d3059137cb0206c855"><td class="memItemLeft" align="right" valign="top"><a id="a86234ed0e92aa7d3059137cb0206c855" name="a86234ed0e92aa7d3059137cb0206c855"></a>
sbit Soft_I2C_Scl at&#160;</td><td class="memItemRight" valign="bottom"><b>RB3_bit</b></td></tr>
<tr class="separator:a86234ed0e92aa7d3059137cb0206c855"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbe2317f3d1b554a8e9ddfd296d494ab" id="r_afbe2317f3d1b554a8e9ddfd296d494ab"><td class="memItemLeft" align="right" valign="top"><a id="afbe2317f3d1b554a8e9ddfd296d494ab" name="afbe2317f3d1b554a8e9ddfd296d494ab"></a>
sbit Soft_I2C_Sda_Direction at&#160;</td><td class="memItemRight" valign="bottom"><b>TRISB2_bit</b></td></tr>
<tr class="separator:afbe2317f3d1b554a8e9ddfd296d494ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb4bcdd50314a1ff1979dfa2c83bf64b" id="r_afb4bcdd50314a1ff1979dfa2c83bf64b"><td class="memItemLeft" align="right" valign="top"><a id="afb4bcdd50314a1ff1979dfa2c83bf64b" name="afb4bcdd50314a1ff1979dfa2c83bf64b"></a>
sbit Soft_I2C_Scl_Direction at&#160;</td><td class="memItemRight" valign="bottom"><b>TRISB3_bit</b></td></tr>
<tr class="separator:afb4bcdd50314a1ff1979dfa2c83bf64b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>File with second stop of project integration. </p>
<p>This file contains code that integrates driving the car module with servo-sensor module. So this code does all the stuff that is shown in integration/servo_sensor.c program, but also has the ability to drive the car around based on sensor reading. Besides servo-sensor functions this code has:</p><ul>
<li>initialization of I2C for driving</li>
<li>functions for driving forward, and braking the car </li>
</ul>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aff9b2f2caddd39a66f030c08ef987cd1" name="aff9b2f2caddd39a66f030c08ef987cd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff9b2f2caddd39a66f030c08ef987cd1">&#9670;&#160;</a></span>brake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void brake </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for braking the wheels of the car, that are effectively stopping the car. </p>

</div>
</div>
<a id="acb6983eff31c6153e994997ac3381358" name="acb6983eff31c6153e994997ac3381358"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb6983eff31c6153e994997ac3381358">&#9670;&#160;</a></span>drive_forward()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void drive_forward </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for driving the car forward by setting PWM values and thus controlling the DC motors on the wheels. </p>

</div>
</div>
<a id="a75f5d9cca5076d0db292bfc3ca3d7170" name="a75f5d9cca5076d0db292bfc3ca3d7170"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75f5d9cca5076d0db292bfc3ca3d7170">&#9670;&#160;</a></span>I2C_Send_Message()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void I2C_Send_Message </td>
          <td>(</td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>dev_addr</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>reg_addr</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>data_value</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for I2C controller configuration. It addresses device, then desired register, and puts some value in it </p>

</div>
</div>
<a id="a5e59225bfc4259591f302dc1b70f53a1" name="a5e59225bfc4259591f302dc1b70f53a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e59225bfc4259591f302dc1b70f53a1">&#9670;&#160;</a></span>initialize_ADC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initialize_ADC </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function that initializes ADC needed for sensor reading </p>
<p>Init ADC to use 10-bit module, and use Internal voltage reference(AVDD, AVSS)</p>

</div>
</div>
<a id="ab4a39a9450cbc2f03a62869640d443b6" name="ab4a39a9450cbc2f03a62869640d443b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4a39a9450cbc2f03a62869640d443b6">&#9670;&#160;</a></span>initialize_I2C()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initialize_I2C </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function for I2C controller ,on the driver board, initialization. What is does is that is addresses some registers of the PCA9633 I2C driver ,according to the datasheet, and puts appropriate values in them, in order for the car to be able to drive. </p>

</div>
</div>
<a id="aa44e519f68ab22d530cd062dd7049fee" name="aa44e519f68ab22d530cd062dd7049fee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa44e519f68ab22d530cd062dd7049fee">&#9670;&#160;</a></span>initialize_servo_for_sensor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initialize_servo_for_sensor </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function that initializes servo_sensor, by setting a PWM pin, and configures PWM. </p>
<p>set pin RB14 to work in open drain configuration</p>
<p>set up PWM pin, RB(P)14 <br  />
</p>
<p>get PWM period for duty cycle count</p>
<p>set 50Hz period, channel 1, no prescaler, timer 2</p>

</div>
</div>
<a id="acdef7a1fd863a6d3770c1268cb06add3" name="acdef7a1fd863a6d3770c1268cb06add3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdef7a1fd863a6d3770c1268cb06add3">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void main </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Main function, entry point of the program </p>

</div>
</div>
<a id="a4f0ff40e5886cd651113e8706b5ee772" name="a4f0ff40e5886cd651113e8706b5ee772"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f0ff40e5886cd651113e8706b5ee772">&#9670;&#160;</a></span>scan_space_with_sensor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scan_space_with_sensor </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function that moves servo_sensor 180 degrees and stores sensor reading from different positions Moving the servo is done in for loop, by changing PWM duty cycles with some delay because of the limits of servo motor. </p>

</div>
</div>
<a id="aa7799a5f0d85ef019453dfe5e24bb7d1" name="aa7799a5f0d85ef019453dfe5e24bb7d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7799a5f0d85ef019453dfe5e24bb7d1">&#9670;&#160;</a></span>set_servo_sensor_to_starting_pos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_servo_sensor_to_starting_pos </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Functions that sets servo to its starting position, by setting appropriate duty cycle of the PWM </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
